<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>使用python操作mysql数据库 | 小张小张有点嚣张</title>
    <meta name="generator" content="VuePress 1.4.1">
    
    <meta name="description" content="个人博客">
    <link rel="preload" href="/vuepressBlog/assets/css/0.styles.b4a764d0.css" as="style"><link rel="preload" href="/vuepressBlog/assets/js/app.c1b405af.js" as="script"><link rel="preload" href="/vuepressBlog/assets/js/2.c2e3befc.js" as="script"><link rel="preload" href="/vuepressBlog/assets/js/7.e56e811f.js" as="script"><link rel="prefetch" href="/vuepressBlog/assets/js/10.0aeed0a0.js"><link rel="prefetch" href="/vuepressBlog/assets/js/11.d3c9595c.js"><link rel="prefetch" href="/vuepressBlog/assets/js/12.2ca11fc2.js"><link rel="prefetch" href="/vuepressBlog/assets/js/13.ef8ea748.js"><link rel="prefetch" href="/vuepressBlog/assets/js/14.cda0af41.js"><link rel="prefetch" href="/vuepressBlog/assets/js/15.8cf3c9a9.js"><link rel="prefetch" href="/vuepressBlog/assets/js/16.37b18be4.js"><link rel="prefetch" href="/vuepressBlog/assets/js/17.35e21df8.js"><link rel="prefetch" href="/vuepressBlog/assets/js/18.a4f3ce87.js"><link rel="prefetch" href="/vuepressBlog/assets/js/19.9c386264.js"><link rel="prefetch" href="/vuepressBlog/assets/js/20.0c6eacb8.js"><link rel="prefetch" href="/vuepressBlog/assets/js/21.ccce3d92.js"><link rel="prefetch" href="/vuepressBlog/assets/js/22.3dadc292.js"><link rel="prefetch" href="/vuepressBlog/assets/js/23.9a6c3566.js"><link rel="prefetch" href="/vuepressBlog/assets/js/24.ab8ccb6d.js"><link rel="prefetch" href="/vuepressBlog/assets/js/25.d9ea8933.js"><link rel="prefetch" href="/vuepressBlog/assets/js/26.5ab485cd.js"><link rel="prefetch" href="/vuepressBlog/assets/js/27.57728a4e.js"><link rel="prefetch" href="/vuepressBlog/assets/js/3.4718697e.js"><link rel="prefetch" href="/vuepressBlog/assets/js/4.c32c57ad.js"><link rel="prefetch" href="/vuepressBlog/assets/js/5.71a90178.js"><link rel="prefetch" href="/vuepressBlog/assets/js/6.5781d4ba.js"><link rel="prefetch" href="/vuepressBlog/assets/js/8.36e130b0.js"><link rel="prefetch" href="/vuepressBlog/assets/js/9.1af2aa3c.js">
    <link rel="stylesheet" href="/vuepressBlog/assets/css/0.styles.b4a764d0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuepressBlog/" class="home-link router-link-active"><!----> <span class="site-name">小张小张有点嚣张</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vuepressBlog/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/vuepressBlog/vuepress/01_初始化vuepress.html" class="nav-link">
  vuepress指南
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepressBlog/TypeScript/chapter1/01_初识TS.html" class="nav-link">
  TypeScript
</a></li><li class="dropdown-item"><!----> <a href="/vuepressBlog/Vue/Vue.html" class="nav-link">
  Vue
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepressBlog/Dgango/ORM.html" class="nav-link">
  Dgango
</a></li><li class="dropdown-item"><!----> <a href="/vuepressBlog/MySQL/MySQL安装.html" class="nav-link">
  MySQL
</a></li></ul></div></div> <a href="https://github.com/zhangweigaizhe/vuepressBlog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vuepressBlog/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/vuepressBlog/vuepress/01_初始化vuepress.html" class="nav-link">
  vuepress指南
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepressBlog/TypeScript/chapter1/01_初识TS.html" class="nav-link">
  TypeScript
</a></li><li class="dropdown-item"><!----> <a href="/vuepressBlog/Vue/Vue.html" class="nav-link">
  Vue
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepressBlog/Dgango/ORM.html" class="nav-link">
  Dgango
</a></li><li class="dropdown-item"><!----> <a href="/vuepressBlog/MySQL/MySQL安装.html" class="nav-link">
  MySQL
</a></li></ul></div></div> <a href="https://github.com/zhangweigaizhe/vuepressBlog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/vuepressBlog/MySQL/MySQL安装.html" class="sidebar-link">MySQL安装</a></li><li><a href="/vuepressBlog/MySQL/表的操作.html" class="sidebar-link">表的操作</a></li><li><a href="/vuepressBlog/MySQL/表的记录操作.html" class="sidebar-link">表的记录操作</a></li><li><a href="/vuepressBlog/MySQL/pyMySQL.html" class="active sidebar-link">使用python操作mysql数据库</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepressBlog/MySQL/pyMySQL.html#数据库的安装和连接" class="sidebar-link">数据库的安装和连接</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepressBlog/MySQL/pyMySQL.html#pymysql的安装" class="sidebar-link">PyMySQL的安装</a></li><li class="sidebar-sub-header"><a href="/vuepressBlog/MySQL/pyMySQL.html#python连接数据库" class="sidebar-link">python连接数据库</a></li></ul></li><li class="sidebar-sub-header"><a href="/vuepressBlog/MySQL/pyMySQL.html#创建表操作" class="sidebar-link">创建表操作</a></li><li class="sidebar-sub-header"><a href="/vuepressBlog/MySQL/pyMySQL.html#操作数据" class="sidebar-link">操作数据</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepressBlog/MySQL/pyMySQL.html#_1-插入操作" class="sidebar-link">1.插入操作</a></li><li class="sidebar-sub-header"><a href="/vuepressBlog/MySQL/pyMySQL.html#_2-查询操作" class="sidebar-link">2.查询操作</a></li><li class="sidebar-sub-header"><a href="/vuepressBlog/MySQL/pyMySQL.html#_3-更新操作" class="sidebar-link">3.更新操作</a></li><li class="sidebar-sub-header"><a href="/vuepressBlog/MySQL/pyMySQL.html#_4-删除操作" class="sidebar-link">4.删除操作</a></li></ul></li><li class="sidebar-sub-header"><a href="/vuepressBlog/MySQL/pyMySQL.html#数据备份" class="sidebar-link">数据备份</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepressBlog/MySQL/pyMySQL.html#_1-数据库的逻辑备份" class="sidebar-link">1.数据库的逻辑备份</a></li><li class="sidebar-sub-header"><a href="/vuepressBlog/MySQL/pyMySQL.html#_2-数据恢复" class="sidebar-link">2.数据恢复</a></li></ul></li><li class="sidebar-sub-header"><a href="/vuepressBlog/MySQL/pyMySQL.html#事务和锁" class="sidebar-link">事务和锁</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="使用python操作mysql数据库"><a href="#使用python操作mysql数据库" class="header-anchor">#</a> 使用python操作mysql数据库</h1> <h2 id="数据库的安装和连接"><a href="#数据库的安装和连接" class="header-anchor">#</a> 数据库的安装和连接</h2> <h3 id="pymysql的安装"><a href="#pymysql的安装" class="header-anchor">#</a> PyMySQL的安装</h3> <div class="language- extra-class"><pre class="language-text"><code>pip install PyMySQL
</code></pre></div><h3 id="python连接数据库"><a href="#python连接数据库" class="header-anchor">#</a> python连接数据库</h3> <div class="language- extra-class"><pre class="language-text"><code>import pymysql

db = pymysql.connect(&quot;数据库ip&quot;,&quot;用户&quot;,&quot;密码&quot;,&quot;数据库&quot; ) # 打开数据库连接
cursor = db.cursor()                                   # 使用 cursor() 方法创建一个游标对象 cursor
cursor.execute(&quot;SELECT VERSION()&quot;)                     # 使用 execute() 方法执行 SQL 查询
data = cursor.fetchone()                               # 使用 fetchone() 方法获取单条数据
print (&quot;Database version : %s &quot; % data)
db.close()  
</code></pre></div><h2 id="创建表操作"><a href="#创建表操作" class="header-anchor">#</a> 创建表操作</h2> <div class="language- extra-class"><pre class="language-text"><code>import pymysql
 
# 打开数据库连接
db = pymysql.connect(&quot;localhost&quot;,&quot;testuser&quot;,&quot;test123&quot;,&quot;TESTDB&quot; )
 
# 使用 cursor() 方法创建一个游标对象 cursor
cursor = db.cursor()
 
# 使用 execute() 方法执行 SQL，如果表存在则删除
cursor.execute(&quot;DROP TABLE IF EXISTS EMPLOYEE&quot;)
 
# 使用预处理语句创建表
sql = &quot;&quot;&quot;CREATE TABLE EMPLOYEE (
         FIRST_NAME  CHAR(20) NOT NULL,
         LAST_NAME  CHAR(20),
         AGE INT,  
         SEX CHAR(1),
         INCOME FLOAT )&quot;&quot;&quot;
 
cursor.execute(sql)
 
# 关闭数据库连接
db.close()
</code></pre></div><h2 id="操作数据"><a href="#操作数据" class="header-anchor">#</a> 操作数据</h2> <h3 id="_1-插入操作"><a href="#_1-插入操作" class="header-anchor">#</a> 1.插入操作</h3> <div class="language- extra-class"><pre class="language-text"><code>import pymysql
 
# 打开数据库连接
db = pymysql.connect(&quot;localhost&quot;,&quot;testuser&quot;,&quot;test123&quot;,&quot;TESTDB&quot; )
 
# 使用cursor()方法获取操作游标 
cursor = db.cursor()
 
# SQL 插入语句
sql = &quot;&quot;&quot;INSERT INTO EMPLOYEE(FIRST_NAME,
         LAST_NAME, AGE, SEX, INCOME)
         VALUES ('Mac', 'Mohan', 20, 'M', 2000)&quot;&quot;&quot;
try:
   cursor.execute(sql) # 执行sql语句
   db.commit()         # 提交到数据库执行
except:
   db.rollback()       # 如果发生错误则回滚
 
# 关闭数据库连接
db.close()
</code></pre></div><h3 id="_2-查询操作"><a href="#_2-查询操作" class="header-anchor">#</a> 2.查询操作</h3> <p>Python查询Mysql使用 fetchone() 方法获取单条数据, 使用fetchall() 方法获取多条数据。</p> <ul><li><strong>fetchone()</strong>: 该方法获取下一个查询结果集。结果集是一个对象</li> <li><strong>fetchall()</strong>: 接收全部的返回结果行.</li> <li><strong>rowcount</strong>: 这是一个只读属性，并返回执行execute()方法后影响的行数。</li></ul> <div class="language- extra-class"><pre class="language-text"><code>import pymysql
 
# 打开数据库连接
db = pymysql.connect(&quot;localhost&quot;,&quot;testuser&quot;,&quot;test123&quot;,&quot;TESTDB&quot; )
 
# 使用cursor()方法获取操作游标 
cursor = db.cursor()
 
# SQL 查询语句
sql = &quot;SELECT * FROM EMPLOYEE \
       WHERE INCOME &gt; %s&quot; % (1000)
try:
   
   cursor.execute(sql)# 执行SQL语句
   results = cursor.fetchall()# 获取所有记录列表
   for row in results:
      fname = row[0]
      lname = row[1]
      age = row[2]
      sex = row[3]
      income = row[4]
       # 打印结果
      print (&quot;fname=%s,lname=%s,age=%s,sex=%s,income=%s&quot; % \
             (fname, lname, age, sex, income ))
except:
   print (&quot;Error: unable to fetch data&quot;)
 
# 关闭数据库连接
db.close()
</code></pre></div><h3 id="_3-更新操作"><a href="#_3-更新操作" class="header-anchor">#</a> 3.更新操作</h3> <div class="language- extra-class"><pre class="language-text"><code>import pymysql
 
# 打开数据库连接
db = pymysql.connect(&quot;localhost&quot;,&quot;testuser&quot;,&quot;test123&quot;,&quot;TESTDB&quot; )
 
# 使用cursor()方法获取操作游标 
cursor = db.cursor()
 
# SQL 更新语句
sql = &quot;UPDATE EMPLOYEE SET AGE = AGE + 1 WHERE SEX = '%c'&quot; % ('M')
try:
   cursor.execute(sql)  # 执行SQL语句
   db.commit()          # 提交到数据库执行
except
   db.rollback()        # 发生错误时回滚
 
# 关闭数据库连接
db.close()
</code></pre></div><h3 id="_4-删除操作"><a href="#_4-删除操作" class="header-anchor">#</a> 4.删除操作</h3> <div class="language- extra-class"><pre class="language-text"><code>import pymysql
 
# 打开数据库连接
db = pymysql.connect(&quot;localhost&quot;,&quot;testuser&quot;,&quot;test123&quot;,&quot;TESTDB&quot; )
 
# 使用cursor()方法获取操作游标 
cursor = db.cursor()
 
# SQL 删除语句
sql = &quot;DELETE FROM EMPLOYEE WHERE AGE &gt; %s&quot; % (20)
try
   cursor.execute(sql)  # 执行SQL语句
   db.commit()          # 提交修改
except
   db.rollback()        # 发生错误时回滚# 关闭连接
db.close()
</code></pre></div><h2 id="数据备份"><a href="#数据备份" class="header-anchor">#</a> 数据备份</h2> <h3 id="_1-数据库的逻辑备份"><a href="#_1-数据库的逻辑备份" class="header-anchor">#</a> 1.数据库的逻辑备份</h3> <div class="language- extra-class"><pre class="language-text"><code>#语法：
# mysqldump -h 服务器 -u用户名 -p密码 数据库名 &gt; 备份文件.sql

#示例：
#单库备份
mysqldump -uroot -p123 db1 &gt; db1.sql
mysqldump -uroot -p123 db1 table1 table2 &gt; db1-table1-table2.sql

#多库备份
mysqldump -uroot -p123 --databases db1 db2 mysql db3 &gt; db1_db2_mysql_db3.sql

#备份所有库
mysqldump -uroot -p123 --all-databases &gt; all.sql 
</code></pre></div><h3 id="_2-数据恢复"><a href="#_2-数据恢复" class="header-anchor">#</a> 2.数据恢复</h3> <div class="language- extra-class"><pre class="language-text"><code>#方法一：
[root@egon backup]# mysql -uroot -p123 &lt; /backup/all.sql

#方法二：
mysql&gt; use db1;
mysql&gt; SET SQL_LOG_BIN=0;   #关闭二进制日志，只对当前session生效
mysql&gt; source /root/db1.sql
</code></pre></div><h2 id="事务和锁"><a href="#事务和锁" class="header-anchor">#</a> 事务和锁</h2> <div class="language- extra-class"><pre class="language-text"><code>begin;  # 开启事务
select * from emp where id = 1 for update;  # 查询id值，for update添加行锁；
update emp set salary=10000 where id = 1; # 完成更新
commit; # 提交事务
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/zhangweigaizhe/vuepressBlog/edit/master/MySQL/pyMySQL.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页 ！</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vuepressBlog/MySQL/表的记录操作.html" class="prev">
        表的记录操作
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/vuepressBlog/assets/js/app.c1b405af.js" defer></script><script src="/vuepressBlog/assets/js/2.c2e3befc.js" defer></script><script src="/vuepressBlog/assets/js/7.e56e811f.js" defer></script>
  </body>
</html>
